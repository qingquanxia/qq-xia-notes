<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-08-28">

<title>Part 2, Discrete Time – QQ Xia</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-6a1adf5308eb899d9c94ac9b7ff3aa0f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../physics/continuous-fourier.html">Physics</a></li><li class="breadcrumb-item"><a href="../physics/discrete-time.html">Part 2, Discrete Time</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">QQ Xia</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Physics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../physics/continuous-fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 1, The continuous world: Fourier series to Fourier transforms</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../physics/discrete-time.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Part 2, Discrete Time</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../physics/dirac-comb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 3, Unifying the continuous and discrete worlds: the dirac comb</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../physics/spectral-theorem.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Spectral Theorem</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Math</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../math/fundamental-theorem-alg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3 Proofs of the Fundamental Theorem of Algebra</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../math/maximum-ratio-combining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Maximal Ratio Combining</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-dft" id="toc-the-dft" class="nav-link active" data-scroll-target="#the-dft">The DFT</a></li>
  <li><a href="#the-dtft" id="toc-the-dtft" class="nav-link" data-scroll-target="#the-dtft">The DTFT</a></li>
  <li><a href="#additional-topics" id="toc-additional-topics" class="nav-link" data-scroll-target="#additional-topics">Additional topics</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../physics/continuous-fourier.html">Physics</a></li><li class="breadcrumb-item"><a href="../physics/discrete-time.html">Part 2, Discrete Time</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Part 2, Discrete Time</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 28, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="hidden">

</div>
<p>This article is part of a series:</p>
<ol type="1">
<li><a href="../physics/continuous-fourier.html">Part 1, The continuous world: Fourier series to Fourier transforms</a></li>
<li><a href="../physics/discrete-time.html">Part 2, Discrete time</a></li>
<li><a href="../physics/dirac-comb.html">Part 3, Unifying the continuous and discrete worlds: the dirac comb</a></li>
</ol>
<p>The purpose of this post is mainly to provide intuition about how signals are discretized. Please don’t lose sleep over how messy the math here is. The next article will provide a powerful tool which will immensely simplify many of the formulas in this article.</p>
<p>The modern truth is that even though the things we care about are analog, computers live in a digital world. Any signal processing done inside a computer must both be discrete in the time domain, and also represent values with limited precision.</p>
<p>To explain the math though, let’s assume for the remainder of the article that we can represent real numbers with infinite precision, and that we are only forced to discretize the time domain.</p>
<p>With the Fourier series as our predecessor, we now work out the discrete fourier transform (DFT).</p>
<section id="the-dft" class="level2">
<h2 class="anchored" data-anchor-id="the-dft">The DFT</h2>
<p>Consider the set of functions <span class="math inline">\(f: \{0, \cdots, N-1\} {\rightarrow}{\bf C}\)</span>. These form a complex inner product space, with their inner product defined as <span class="math inline">\(\braket{f|g} = \sum_{n=0}^{N-1} f^*(n) g(n)\)</span>. In fact this is nothing more than the vector space <span class="math inline">\({\bf C}^N\)</span>.</p>
<p><span class="math inline">\(\braket{e^{2\pi i k_1 n} | e^{2\pi i k_2 n}} = \sum_{n=0}^{N-1} e^{2\pi i (k_2-k_1)n} = \frac{1-e^{2\pi i (k_2-k_1)N}}{1-e^{2\pi i (k_2-k_1)}}\)</span>. This is zero if and only if <span class="math inline">\(2\pi (k_2 - k_1)N = 2\pi k\)</span> for some integer <span class="math inline">\(k\)</span>, that is, <span class="math inline">\(k_2-k_1 = k/N\)</span>. The intuition behind these formulas is that when the condition is satisfied, the terms in the sum form <span class="math inline">\(N\)</span> evenly spaced rays shining from the origin of the complex plane, which add to zero because of their symmetry.</p>
<p>Hence, <span class="math inline">\(\{e^{2\pi i (k/N)n}\}_{k\in {\bf Z}}\)</span> is an orthogonal set of functions. However, any two functions where <span class="math inline">\(k\)</span> differs by a multiple of <span class="math inline">\(N\)</span> are actually the same function on our discrete set of points. This is because <span class="math inline">\(e^{2\pi i (0/N)n} = e^{2\pi i (N/N)n} = 1\)</span> for all integers <span class="math inline">\(n\)</span>. This effect is known as aliasing.</p>
<div class="callout callout-style-simple callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Aliasing
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Aliasing is the same reason why in movies a racecar’s wheel will be seen slowly turning backwards even as the car is blazing at over 120mph down a freeway. A typical video sampling rate is 60 frames per second. This means that if the tire made 60 revolutions per second = 3600rpm, then on each frame of the video the wheel will be in exactly the same position. So 61 revolutions per second would alias down to 1 revolution per second, that is, the tire slowly crawling forward, whereas 59 revolutions per second would alias down to -1 revolution per second, that is, the tire slowly crawling backward.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/aliasing.png" class="img-fluid figure-img"></p>
<figcaption>Figure from <a href="https://people.eecs.berkeley.edu/~arcak/resources/16Breader.pdf">Arcak’s Berkeley EE16B Sp17 lecture notes</a></figcaption>
</figure>
</div>
</div>
</div>
</div>
<p>Because of aliasing, our actual orthonormal basis is <span class="math inline">\(\{\frac{1}{\sqrt{N}} e^{2\pi i (k/N)n}\}_{k \in \{0, \cdots, N-1\}}\)</span>. It makes sense that we have <span class="math inline">\(N\)</span> basis functions, since our original vector space was of dimension <span class="math inline">\(N\)</span>.</p>
<p>We now define our discrete fourier transform, which is standard in practically all software implementations:</p>
<p><span class="math display">\[
\boxed{
    \begin{aligned}
    \mathrm{DFT}[x(n)] &amp;=\sum_{n=0}^{N-1} e^{-2\pi ikn/N} x(n) \\
    \mathrm{IDFT}[X(k)] &amp;=\frac{1}{N}\sum_{n=0}^{N-1} e^{2\pi ikn/N} X(k)
    \end{aligned}
}
\]</span></p>
<p>Note that instead of having a <span class="math inline">\(1/\sqrt{N}\)</span> in both transforms to make them symmetric, we’ve placed the entire <span class="math inline">\(N\)</span> term in the inverse transform. This makes the transform non-unitary. The reasons for this, however, will become clear in the next article.</p>
<p>So far we’ve been using integer values for <span class="math inline">\(n\)</span>. If we place our domain of <span class="math inline">\(N\)</span> points in the time-domain though, and change variables so <span class="math inline">\(t = \Delta t n\)</span> for some scale factor <span class="math inline">\(\Delta t\)</span>, then our orthonormal functions become <span class="math inline">\(\{\frac{1}{\sqrt{N}} e^{2\pi i (\frac{k}{N\Delta t})t}\}_{k \in \{0, \cdots, N-1\}}\)</span>, so that in the frequency domain our points are spaced <span class="math inline">\(\frac{1}{N\Delta t}\)</span> apart.</p>
</section>
<section id="the-dtft" class="level2">
<h2 class="anchored" data-anchor-id="the-dtft">The DTFT</h2>
<p>So far, our DFT can handle functions which periodic with period <span class="math inline">\(N\)</span>. What if we want to handle an aperiodic signal though? Suppose we have an audio CD recorder that is responsible for sampling an analog sound wave at 44.1kHz. Every 1/44.1kHz <span class="math inline">\(\approx\)</span> 22.7us, this ADC (analog-to-digital converter) will capture the amplitude at its input, round it to, say, the nearest 8-bit value, and then output it as a practically endless stream of numbers. In theory, it has been running since the beginning of time and will continue to run after the stars burn out.</p>
<p>How do we model this? Perhaps we could imitate what we did in the continuous case. Take our DFT scenario, and imagine the limit as <span class="math inline">\(N{\rightarrow}\infty\)</span>. But if we only extend the right side of our domain to infinity, we’re stuck with a left end which is fixed at 0. Should we perhaps consider <span class="math inline">\(\{-N, \cdots N\}\)</span> to be our domain instead? At this point I got bogged down in the details of the math and never completed it.</p>
<p>Fortunately, we don’t have to do this, because we had already derived the answer in the previous article! Take a look at the following figure, which summarizes all the things that we have derived so far. There is a pattern which allows us to immediately write down the equation.</p>
<p><img src="../assets/fourier-domains.svg" class="img-fluid"></p>
<p>Because of the wonderful duality of these transforms, we can pretty much copy the Fourier series transforms verbatim to arrive at the Discrete Time Fourier Transform (DTFT):</p>
<p><span class="math display">\[
\begin{align}
\mathrm{DFTF}[x(n)] &amp;= \sum_{n=-\infty}^{\infty} e^{-2\pi i kn} x(n) \\
\mathrm{IDFTF}[X(k)] &amp;= \int_{k=0}^1 e^{2\pi i kn} X(k) dk
\end{align}
\]</span></p>
<section id="todo-z-domain" class="level4">
<h4 class="anchored" data-anchor-id="todo-z-domain">TODO: z-domain</h4>
<p>Many people choose to think in terms of <span class="math inline">\(z^n\)</span>, where <span class="math inline">\(z=e^{2\pi ik}\)</span></p>
</section>
<section id="the-nyquist-shannon-theorem" class="level4">
<h4 class="anchored" data-anchor-id="the-nyquist-shannon-theorem">The Nyquist-Shannon theorem</h4>
<p>We can now explain the outrageous claim of the Nyquist-Shannon sampling theorem. What it says is if you have a continuous function which in the frequency domain has bandwidth <span class="math inline">\(F\)</span>, as long as you sample it at a frequency greater than <span class="math inline">\(F\)</span>, you have preserved ALL the information of that function.</p>
<p>From our sampled points, we can perfectly reconstruct the original signal with a magical process called sinc interpolation: essentially we multiply each sample by a time-shifted sinc function and add them all up. Intuitively this makes sense, since each sinc function is 1 at the sample and 0 for all other samples, so it acts like a sort of smooth “basis”, and changing the value of one sample will not affect the interpolation at the other samples.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../assets/sinc-interpolation.png" class="img-fluid figure-img"></p>
<figcaption>Figure from <a href="https://people.eecs.berkeley.edu/~arcak/resources/16Breader.pdf">Arcak’s Berkeley EE16B Sp17 lecture notes</a></figcaption>
</figure>
</div>
<p>With the DTFT in hand though, we can now analyze this more rigorously. Let’s say our signal is <span class="math inline">\(x(t)\)</span>, and its Fourier transform is <span class="math inline">\(X(f) = \int_{-\infty}^{\infty} e^{-2\pi ift}x(t)dt\)</span>. Suppose <span class="math inline">\(X(f)\)</span> lies completely within the interval <span class="math inline">\([a,b]\)</span>, where <span class="math inline">\(a-b=F\)</span>. In that case, we can represent <span class="math inline">\(X(f)\)</span> by its Fourier series: <span class="math display">\[\int_a^b e^{2\pi itf}X(f)df = \int_{-\infty}^\infty e^{2\pi itf}X(f)df = x(t)\]</span> The assumption that <span class="math inline">\(X(f)\)</span> is band-limited is crucial to the equality of the coefficients of the Fourier series and the Fourier transform. The Fourier series has as its domain <span class="math inline">\(\{\frac{n}{b-a}\}_{n\in{\bf Z}}\)</span>. Hence the coefficients of the Fourier series is nothing more than <span class="math inline">\(x(t)\)</span> sampled at a rate of <span class="math inline">\(F\)</span>. At the same time, we know that we can use these coefficients to perfectly reconstruct the frequency spectrum lying in the interval <span class="math inline">\([a,b]\)</span>, and hence perfectly reconstruct the original signal <span class="math inline">\(x(t)\)</span>.</p>
<p><img src="../assets/freq-window.svg" class="img-fluid"></p>
<p>From a frequency domain perspective, what we are essentially doing to <span class="math inline">\(X(f)\)</span> was multiplying it by a square window. But of course, in the time domain that corresponds to convolution by sinc….</p>
</section>
</section>
<section id="additional-topics" class="level2">
<h2 class="anchored" data-anchor-id="additional-topics">Additional topics</h2>
<p>We glossed over the fact that not only are computers discretized in time, they are also limited in the precision they can represent real amplitudes. When they round to the nearest representable level, they introduce <a href="https://en.wikipedia.org/wiki/Quantization_(signal_processing)">quantization noise</a>. This noise is often modeled as Gaussian (even though it isn’t), and it has an average power relative to full scale, which must be carefully considered in system design. I might expand this section once I learn more about this.</p>
<p>One other fascinating topic is how the DFT is actually implemented in software. A naive coding of the formula would yield a runtime of <span class="math inline">\(O(N^2)\)</span>. In the 1960s, an algorithm was discovered that ran in time <span class="math inline">\(O(N\log N)\)</span>. It was dubbed the title of “Fast Fourier Transform” (FFT). This discovery completely revolutionized the field of signal processing, and for the first time made it feasible to process in the digital domain. There is a <a href="https://www.youtube.com/watch?v=h7apO7q16V0">very elegant explanation</a> of the FFT which casts the problem as a polynomial multiplication problem to exploit very subtle symmetries.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/qingquanxia\.github\.io\/qq-xia-notes\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>